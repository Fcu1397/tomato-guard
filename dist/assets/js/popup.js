import{d as I,r as _,w as b,o as g,c as l,a as u,t as y,_ as D,b as E,e as r,f as p,n as A,g as k,h as M,v as B,i as C}from"./_plugin-vue_export-helper.js";import{D as N,S}from"./types.js";const U={class:"timer-display"},L=I({__name:"TimerDisplay",props:{endTime:{type:Number,required:!0},state:{type:String,required:!0}},setup(T){const t=T,n=_("--:--");let s=null;const m=o=>{if(o<=0)return"00:00";const d=Math.round(o/1e3),f=Math.floor(d/60),h=d%60;return`${String(f).padStart(2,"0")}:${String(h).padStart(2,"0")}`},v=()=>{const o=t.endTime-Date.now();n.value=m(o)};return b(()=>[t.endTime,t.state],()=>{s&&clearInterval(s),t.state==="IDLE"?n.value=m(N.focusDuration*60*1e3):(v(),s=window.setInterval(v,1e3))},{immediate:!0}),g(()=>{s&&clearInterval(s)}),(o,d)=>(u(),l("div",U,y(n.value),1))}}),F=D(L,[["__scopeId","data-v-b7ba7b80"]]),G={class:"popup-container"},P={key:0},R={key:1},x={class:"unlock-view"},V={key:0,class:"error-message"},K=I({__name:"App",setup(T){const t=_({state:"IDLE",endTime:0}),n=_(""),s=_("");function m(a){const e=new ArrayBuffer(a.length*2),i=new Uint16Array(e);for(let c=0,w=a.length;c<w;c++)i[c]=a.charCodeAt(c);return e}function v(a){return Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,"0")).join("")}function o(a){return new Uint8Array(a.match(/.{1,2}/g).map(e=>parseInt(e,16))).buffer}const d=()=>chrome.runtime.sendMessage({command:"START_TIMER"}),f=()=>chrome.runtime.sendMessage({command:"STOP_TIMER"}),h=async()=>{if(s.value="",!n.value){s.value="Password cannot be empty.";return}const e=(await chrome.storage.local.get(S.SETTINGS))[S.SETTINGS];if(!e||!e.passwordHash||!e.salt){s.value="Password not set in options.";return}try{const i=await crypto.subtle.importKey("raw",m(n.value),{name:"PBKDF2"},!1,["deriveBits"]),c=await crypto.subtle.deriveBits({name:"PBKDF2",salt:o(e.salt),iterations:1e5,hash:"SHA-256"},i,256);v(c)===e.passwordHash?f():s.value="Incorrect password."}catch(i){s.value="Verification failed.",console.error(i)}n.value=""};return E(()=>{chrome.runtime.sendMessage({command:"GET_TIMER_DATA"},a=>{t.value=a}),chrome.runtime.onMessage.addListener(a=>{a.type==="TIMER_UPDATED"&&(t.value=a.data)})}),(a,e)=>(u(),l("div",G,[r("header",null,[e[1]||(e[1]=r("h1",null,"Focus Forge",-1)),r("div",{class:A(["status-chip",t.value.state.toLowerCase()])},y(t.value.state),3)]),t.value.state==="IDLE"||t.value.state==="FOCUSING"?(u(),l("main",P,[k(F,{"end-time":t.value.endTime,state:t.value.state},null,8,["end-time","state"]),t.value.state==="IDLE"?(u(),l("button",{key:0,onClick:d,class:"btn-primary"}," Start Focus ")):p("",!0),t.value.state==="FOCUSING"?(u(),l("button",{key:1,onClick:f,class:"btn-secondary"}," Stop & Reset ")):p("",!0)])):p("",!0),t.value.state==="BREAKING"||t.value.state==="BSOD"?(u(),l("main",R,[r("div",x,[e[2]||(e[2]=r("h3",null,"Session Locked",-1)),e[3]||(e[3]=r("p",{class:"unlock-hint"},"Enter password to unlock all tabs.",-1)),M(r("input",{type:"password","onUpdate:modelValue":e[0]||(e[0]=i=>n.value=i),placeholder:"Password",class:"password-input"},null,512),[[B,n.value]]),r("button",{onClick:h,class:"btn-primary"},"Unlock"),s.value?(u(),l("p",V,y(s.value),1)):p("",!0)])])):p("",!0)]))}}),O=D(K,[["__scopeId","data-v-059d3729"]]);C(O).mount("#app");
