import{d as I,r as f,w as E,o as b,c,a as u,t as _,_ as D,b as A,e as i,f as p,n as k,g as M,h as N,v as B,i as C}from"./_plugin-vue_export-helper.js";import{S as T,D as g}from"./types.js";const G={class:"timer-display"},U=I({__name:"TimerDisplay",props:{endTime:{type:Number,required:!0},state:{type:String,required:!0}},setup(S){const t=S,n=f("--:--");let s=null;const m=o=>{if(o<=0)return"00:00";const r=Math.round(o/1e3),y=Math.floor(r/60),a=r%60;return`${String(y).padStart(2,"0")}:${String(a).padStart(2,"0")}`},v=()=>{const o=t.endTime-Date.now();n.value=m(o)},h=async()=>{try{const r=(await chrome.storage.local.get(T.SETTINGS))[T.SETTINGS]||g;n.value=m(r.focusDuration*60*1e3)}catch(o){console.error("Could not retrieve settings, using default",o),n.value=m(g.focusDuration*60*1e3)}};return E(()=>[t.endTime,t.state],()=>{s&&clearInterval(s),t.state==="IDLE"?h():(v(),s=window.setInterval(v,1e3))},{immediate:!0}),b(()=>{s&&clearInterval(s)}),(o,r)=>(u(),c("div",G,_(n.value),1))}}),L=D(U,[["__scopeId","data-v-666367fb"]]),F={class:"popup-container"},P={key:0},R={key:1},x={class:"unlock-view"},V={key:0,class:"error-message"},K=I({__name:"App",setup(S){const t=f({state:"IDLE",endTime:0}),n=f(""),s=f("");function m(a){const e=new ArrayBuffer(a.length*2),l=new Uint16Array(e);for(let d=0,w=a.length;d<w;d++)l[d]=a.charCodeAt(d);return e}function v(a){return Array.from(new Uint8Array(a)).map(e=>e.toString(16).padStart(2,"0")).join("")}function h(a){return new Uint8Array(a.match(/.{1,2}/g).map(e=>parseInt(e,16))).buffer}const o=()=>chrome.runtime.sendMessage({command:"START_TIMER"}),r=()=>chrome.runtime.sendMessage({command:"STOP_TIMER"}),y=async()=>{if(s.value="",!n.value){s.value="Password cannot be empty.";return}const e=(await chrome.storage.local.get(T.SETTINGS))[T.SETTINGS];if(!e||!e.passwordHash||!e.salt){s.value="Password not set in options.";return}try{const l=await crypto.subtle.importKey("raw",m(n.value),{name:"PBKDF2"},!1,["deriveBits"]),d=await crypto.subtle.deriveBits({name:"PBKDF2",salt:h(e.salt),iterations:1e5,hash:"SHA-256"},l,256);v(d)===e.passwordHash?r():s.value="Incorrect password."}catch(l){s.value="Verification failed.",console.error(l)}n.value=""};return A(()=>{chrome.runtime.sendMessage({command:"GET_TIMER_DATA"},a=>{t.value=a}),chrome.runtime.onMessage.addListener(a=>{a.type==="TIMER_UPDATED"&&(t.value=a.data)})}),(a,e)=>(u(),c("div",F,[i("header",null,[e[1]||(e[1]=i("h1",null,"Focus Forge",-1)),i("div",{class:k(["status-chip",t.value.state.toLowerCase()])},_(t.value.state),3)]),t.value.state==="IDLE"||t.value.state==="FOCUSING"?(u(),c("main",P,[M(L,{"end-time":t.value.endTime,state:t.value.state},null,8,["end-time","state"]),t.value.state==="IDLE"?(u(),c("button",{key:0,onClick:o,class:"btn-primary"}," Start Focus ")):p("",!0),t.value.state==="FOCUSING"?(u(),c("button",{key:1,onClick:r,class:"btn-secondary"}," Stop & Reset ")):p("",!0)])):p("",!0),t.value.state==="BREAKING"||t.value.state==="BSOD"?(u(),c("main",R,[i("div",x,[e[2]||(e[2]=i("h3",null,"Session Locked",-1)),e[3]||(e[3]=i("p",{class:"unlock-hint"},"Enter password to unlock all tabs.",-1)),N(i("input",{type:"password","onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),placeholder:"Password",class:"password-input"},null,512),[[B,n.value]]),i("button",{onClick:y,class:"btn-primary"},"Unlock"),s.value?(u(),c("p",V,_(s.value),1)):p("",!0)])])):p("",!0)]))}}),O=D(K,[["__scopeId","data-v-059d3729"]]);C(O).mount("#app");
