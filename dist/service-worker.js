import{D as n,S as e}from"./assets/js/types.js";const i="focusForgeAlarm";async function T(){return(await chrome.storage.local.get(e.TIMER_DATA))[e.TIMER_DATA]||{state:"IDLE",endTime:0}}async function l(a){await chrome.storage.local.set({[e.TIMER_DATA]:a});const s={type:"TIMER_UPDATED",data:a};chrome.runtime.sendMessage(s);const r=await chrome.tabs.query({});for(const c of r)if(c.id)try{await chrome.tabs.sendMessage(c.id,s)}catch{}}async function u(a){await chrome.alarms.clear(i);const s=(await chrome.storage.local.get(e.SETTINGS))[e.SETTINGS]||n,r=a==="FOCUSING"?s.focusDuration:s.breakDuration,c=Date.now()+r*60*1e3;await chrome.alarms.create(i,{delayInMinutes:r}),await l({state:a,endTime:c})}async function d(){await chrome.alarms.clear(i),await l({state:"IDLE",endTime:0})}chrome.runtime.onInstalled.addListener(async()=>{await chrome.storage.local.set({[e.SETTINGS]:n,[e.TIMER_DATA]:{state:"IDLE",endTime:0},[e.CYCLE_COUNT]:0})});chrome.alarms.onAlarm.addListener(async a=>{if(a.name===i){const{state:s}=await T();if(s==="FOCUSING"){try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});t&&t.id&&t.url&&!t.url.startsWith("chrome://")&&await chrome.scripting.executeScript({target:{tabId:t.id},files:["fireworks-script.js"]})}catch(t){console.error("Failed to inject fireworks script:",t)}const r=(await chrome.storage.local.get(e.SETTINGS))[e.SETTINGS]||n,o=((await chrome.storage.local.get(e.CYCLE_COUNT))[e.CYCLE_COUNT]||0)+1,m=await chrome.tabs.query({url:["http://*/*","https://*/*"]});if(o>=r.blueScreenCycles){await chrome.storage.local.set({[e.CYCLE_COUNT]:0}),await l({state:"BSOD",endTime:0});for(const t of m)t.id&&(await chrome.scripting.insertCSS({target:{tabId:t.id},files:["assets/blue-screen.css"]}),await chrome.scripting.executeScript({target:{tabId:t.id},files:["blue-screen-script.js"]}))}else{await chrome.storage.local.set({[e.CYCLE_COUNT]:o}),await u("BREAKING");for(const t of m)t.id&&(await chrome.scripting.insertCSS({target:{tabId:t.id},files:["assets/overlay.css"]}),await chrome.scripting.executeScript({target:{tabId:t.id},files:["content-script.js"]}))}}else s==="BREAKING"&&await d()}});chrome.runtime.onMessage.addListener((a,s,r)=>{if(a.command==="START_TIMER")return u("FOCUSING").then(()=>r({success:!0})),!0;if(a.command==="STOP_TIMER")return d().then(()=>r({success:!0})),!0;if(a.command==="GET_TIMER_DATA")return T().then(c=>r(c)),!0});
